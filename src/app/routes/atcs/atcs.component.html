<div class="card p-0">
  <app-cm-breadcrumb [breadcrumbItems]="[{ parts: ['ATCS Dashboard'], link: '/parking' }]"
       [zoneOptions]="ZoneOptions" [selectedZones]="selectedZones"
        (zoneSelectionChange)="onActionSelectionChange($event)" (configClear)="clearActions()"
        [startDate]="startDate" 
    [endDate]="endDate"
        (dateChange)="handleDateChange($event, $event.category)">
    </app-cm-breadcrumb>
        
   

<div class="card-body">

    <!-- <div class="row align-items-center mb-3">-->
        <!-- Zone Dropdown (Left) -->
       <!-- <div class="col-md-6 d-flex justify-content-start">
            <div class="d-flex align-items-center" *ngIf="isZoneOptionsLoaded">
                <mat-form-field appearance="outline" class="custom-dropdown no-bottom-space">
                    <mat-label>Select Zone</mat-label>
                    <mat-select multiple [(ngModel)]="selectedZones" (selectionChange)="onActionSelectionChange($event)"
                        placeholder="-- Select --">
                        <mat-option class="clear-option" (click)="clearActions()">
                            Clear Selection
                        </mat-option>
                        <mat-option *ngFor="let option of ZoneOptions" [value]="option">
                            {{ option.text }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
        </div>-->

        <!-- Date Picker (Right) -->
       <!-- <div class="col-md-6 d-flex justify-content-end">
            <div class="date-picker-wrapper">
                <mat-form-field appearance="outline" class="custom-date-field no-bottom-space">
                    <mat-label>Enter a date range</mat-label>
                    <mat-date-range-input [rangePicker]="picker">
                        <input matStartDate [value]="startDate" placeholder="Start date"
                            (dateChange)="DateWiseFilter($event,'start')">
                        <input matEndDate [value]="endDate" placeholder="End date"
                            (dateChange)="DateWiseFilter($event,'end')">
                    </mat-date-range-input>
                    <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-date-range-picker #picker></mat-date-range-picker>
                </mat-form-field>
            </div>
        </div>
    </div> -->

    <!-- Main Content: Zonal & Map -->
    <div class="row mb-3">
        <!-- Left Panel: Zonal Overview -->
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center"> <h6>Device Status</h6>   <button mat-icon-button appearance="outline"><mat-icon>refresh</mat-icon></button></div>
                    <app-zonal [fromDate]="startDate" [toDate]="endDate" [zoneIds]="selectedZoneIds"></app-zonal>
                </div>
            </div>
        </div>

        <!-- Right Panel: Map -->
        <!-- Right Panel: Map -->
        <div class="col-md-9">
            <div class="card h-100">
                <div class="card-body position-relative p-0">
                    <!-- Added map-boundary class and removed p-0 so there is padding around the map -->

                    <div *ngIf="siteList && siteList.length > 0; else noFields" class="h-100 w-100 map-boundary">
                        <app-cm-leaflet *ngIf="isMap" [showMap]="isMap" [siteData]="siteList" [labelList]="labelList"
                            [popupData]="popupData" (markerClicked)="onMarkerClicked($event)" [enableDraw]="false">
                        </app-cm-leaflet>
                    </div>

                    <ng-template #noFields>
                        <div class="d-flex align-items-center justify-content-center h-100 text-muted fw-bold">
                            No fields found
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- Corridor View -->
        <div class="col-md-6">
            <div class="card fixed-height-card" [ngClass]="{ fullscreen: isCardExpanded }">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0 fw-bold">Corridor View</h6>
                        <div class="action">
                            <span (click)="expand()" class="cursor-pointer me-2"><img src="assets/img/ci_expand.svg"
                                    alt="Expand"></span>
                            <span><img src="assets/img/more-horiz.svg" alt="More"></span>
                        </div>
                    </div>

                    <mat-form-field appearance="outline" class="w-100 mb-1 no-bottom-space">
                        <mat-label>Select Corridor Junction</mat-label>
                        <mat-select placeholder="Select Junction" [(value)]="selectedCorridorJunction"
                            (selectionChange)="onCorridorJunctionChange($event)">
                            @for (junction of junctions; track junction.value) {
                            <mat-option [value]="junction.value">{{junction.viewValue}}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>

                    <app-corridor [corridorData]="corridorData"></app-corridor>
                </div>
            </div>
        </div>

        <!-- Failures View -->
        <div class="col-md-3">
            <div class="card fixed-height-card">
                <div class="card-body">
                    <h6 class="mb-3 fw-bold d-flex align-items-center">
                        <img src="assets/img/sign-Y.png" alt="" class="me-2" style="height: 18px;">
                        Failures in Functional Junctions
                    </h6>
                    <app-failures [fromDate]="startDate" [toDate]="endDate" [zoneIds]="selectedZoneIds">
                    </app-failures>
                </div>
            </div>
        </div>

        <!-- Cycle View -->
        <div class="col-md-3">
            <div class="card fixed-height-card">
                <div class="card-body">
                    <mat-form-field appearance="outline" class="w-100 mb-1 no-bottom-space">
                        <mat-label>Select Junction</mat-label>
                        <mat-select placeholder="Select Junction" [(value)]="selectedJunction"
                            (selectionChange)="onJunctionChange($event)">
                            @for (junction of junctions; track junction.value) {
                            <mat-option [value]="junction.value">{{junction.viewValue}}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>

                    <app-cycle [junctionName]="selectedJunction" [fromDate]="startDate" [toDate]="endDate"
                        [zoneIds]="selectedZoneIds"> </app-cycle>
                </div>
            </div>
        </div>
    </div>
</div>
</div>